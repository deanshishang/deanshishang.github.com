---
layout: post
title: 路由器启动流程
category: Openwrt
---

### 简介

路由器比计算机多了NVRAM，FLASH以及各式各样的接口，路由器各个部件：

CPU：中央处理单元，用来执行IOS的；
RAM/DRAM：内存，动态随机存储，用于存储临时的运算结果，例如路由表，ARP表，快速交换的缓冲，缓冲数据包，数据队列以及当前配置，加电后，将RAM作为存储装置的工作区域，断电后会丢失；
ROM：只读存储器，存储了路由器的开机诊断程序，引导程序，作用是使得路由器在没有找到有效的IOS软件镜像之前，能够从ROM启动，在系统断电后不会消失程序，保证路由器的稳定性；
NVRAM：非易失RAM，用于存放路由器的启动配置文件，系统启动的时候通过该配置文件来配置软件，里边还包括软件配置的登记值，来决定引导路由器使用哪个映像的参数，重启不会改变里边内容；
FLASH：闪存，可擦除，可编程的ROM，里边包含IOS和微代码，路由器ROM引导程序从falsh中查找ios并启动映像；
接口：用于网络连接；

路由器有自己的操作系统叫做IOS(Internetwork Operating System)，路由器使用IOS完成路由表的生成与维护。

### 路由器的启动过程：

开机首先运行ROM中的自检过程(Power On Self Test)，检查CPU，内存以及各个端口是否正常，然后引导系统(最小操作系统minios，类似BIOS)，接下来路由器运行flash中的IOS，在NVRAM中查找配置文件，并将其装载进入DRAM中，当路由器加载完最小系统之后，如果终端操作，停止装载IOS，则进入监视调试模式，这个模式下，用户可以随便翻查更改文件的启动位置。

1）首先进行POST；
2）从ROM中读取bootstrap，完成初步引导；
3）尝试定位ios文件，在flash中查找ios文件，然后读取，引导路由器；
4）没有找到的话进入BOOT模式，可以自己给路由器中flash中传递一个ios文件，传输完毕之后可以启动到CLI模式中了；
5）路由器如果有ios，开始在NVRAM中的配置中查找STARTUP-CONFIG文件，这是启动配置文件，然后加载所有配置，根据配置来学习生成修改路由表，将所有的配置加载到RAM中，进入用户模式完成启动过程。


