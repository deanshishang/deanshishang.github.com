---
layout: post
title: TCP/IP基础知识
category: Note
---
TCP:Transmission Control Protocol;
IP:Internet Protocol;

![](/image/a.png)

### TCP/IP 互联网基础知识

#### TCP/IP的诞生：

![](/image/b.png)

#### TCP/IP标准化：

TCP/IP含义：利用IP进行通信的时候所用到的协议群的总称，具体来说，IP或者UDP,ICMP,TCP,TELNET,FTP,yiji HTTP等都属于TCP/IP的协议，他们与TCP或者IP的关系紧密，可以说是网际协议族(IPS),都是互联网组成必不可少的协议；

#### 基础知识：

互联网通信时候需要用到相关协议，TCP/IP就是互联网通信协议，各个区域网之间的互联成为了互联网，互联网每个网络都是由骨干网(BackBone)与末端网(Stub)组成的，每个网络之间通过NOC(Network operation center)连接，连接不同运营商即异构网络需要有IX(Internet Exchange)的支持，总之，互联网就是多个异构的网络通过IX互联的一个网络；

![](/image/c.png)

### TCP/IP协议分层模型：

![](/image/d.png)

OSI模型注重通信协议必要的功能是什么，TCP/IP注重的是计算机上实现协议应该开发哪种程序；

#### 硬件(物理层)：

最底层是负责传输数据的硬件，没有统一的定义，因为传输媒介都不一样，另外协议必须建立在能够通信的前提下。

#### 网络接口层(数据链路层)：

网络接口层是利用以太网中的数据链路层进行通信，属于接口层，也就是说，把他当做让NIC起作用的驱动程序，驱动程序就是让操作系统与硬件之间架起桥梁的作用的软件，常常要在操作系统之上安装一些驱动软件来驱动这些硬件设备。

#### 互联网层(网络层)：

使用IP协议，相当于网络层，IP协议基于IP地址转发数据包，作用是将分组数据包发送到目的主机；

互联网就是具备网络层功能的网络；连接互联网的所有主机和路由器一定要具备IP的功能，其他的设备比如网桥，中继器，集线器等不一定具备；

* IP:不具备重发机制，隐含着数据链路层的功能，通过IP不论经过什么底层链路都能到达另外一端，能够跨越网络传送数据包；

* ICMP:数据包在传送的过程中一旦发生丢失或者异常导致无法到对方，需要发给发送端一个异常的通知，ICMP就是针对这个制定的，有时候可以诊断网络；

* ARP:从分组数据包的IP地址中解析出来Mac地址的一种协议；

#### 传输层：

这一层有两个代表的协议，主要的功能就是让应用程序之间实现通信，计算机内部同时用多个程序运行区分的是端口号；

* TCP:能够有效利用带宽，缓解网络拥堵，这个协议是可靠传输协议，能够处理丢包，异常等，通常建立连接的过程需要至少7次的发收包，有网络流量的浪费，不适合电话会议等；

* UDP:面向无连接的传输层协议，没有丢包检测，不会关注对端是否收到，如果需要验证检测需要在应用程序中实现，常用于分组数据较少的多播广播通信等视频通信领域；

#### 应用层(会话层以上)：

TCP/IP的应用架构多数是客户端服务端模式，先架设服务端等待客户端的请求；

* WWW:浏览器与服务端之间的通信协议是HTTP，传输的数据主要格式是HTML，HTTP属于应用层协议，HTML属于表示层协议；

* 电子邮件(SMTP):用到的协议时Simple mail tranfer Protocol，MIME(Multipurpose Internet Mail Extensions)属于表示层协议，可以发送声音等信息；

* 文件传输(FTP):传输的过程可以选择二进制方式还是文本方式， 传输时候会建立两个TCP连接，分别是发送传输请求时候用到的控制连接和实际传输数据时用到的数据连接；

* 远程登录(SSH TELNET):远程登录计算机；

* 网络管理(SNMP):Simple Network Management Protocol，使用这个协议管理的主机，网桥，路由器等称作SNMP代理(Agent)，进行管理的那一段称之为管理器，正式这个管理器和代理用到的协议。

### TCP/IP分层模型与通信实例

如何在媒介上进行传输，从应用层到物理媒介位置进行数据处理的流程。

#### 数据包首部

每个分层中都要对所发送的数据附加一个首部，包含了该层的信息，例如发送的目标地址以及协议相关的消息，所要发送的内容都是数据，如图：

![](/image/e.png)

__包，帧，数据报，段，消息：__ 都是表达数据的术语大致区分如下：包是全能性术语，帧是数据链路层描述包的单位；数据报则表示网络层以上的包的单位，段表示TCP数据流中的单位，消息指应用协议中的数据单位；

#### 发送数据包

依然是甲发送内容为"早上好"的邮件给乙，通信的过程如下：

![](/image/f.png)

* 应用程序中进行的编码处理相当于表示层功能，用户点击收信的时候进行接收邮件，这种管理合适发送接收的功能相当于会话层的功能，在发信的那一刻开始的通信建立TCP连接，用这个连接发送数据首先是将数据发送到下一层TCP来做处理；

* 根据应用会话层的指示，负责建立连接发送数据以及断开连接，为了实现这个功能需要在应用层发送的数据前加入首部，首部包括，两个端口号，校验和以及序号(发送的包种哪部分是数据),随后将附加了TCP首部的包发送给IP;

* IP将TCP传送过来的数据以及首部当做整体数据，并在前边加入IP首部，包含接收端IP地址以及发送端IP地址，后边还有判断是TCP还是UDP的信息，__随后根据路由控制表决定接收IP包得路由器或者主机，随后IP包将发送给这些路由器或者主机的网络接口的驱动程序__ ，实现真正的发送数据，如果尚且不知道MAC地址，可以通过ARP协议查找，只要知道了对端的MAC地址，就可以将MAC地址和IP地址以交给以太网的驱动程序，实现数据传输；

* 网络接口以太网驱动的处理：上层传过来的数据，包一个首部，内容包括，发送接收端的MAC地址，标志以太网类型的以太网数据，产生的以太网数据包会通过物理层传输发送给接收端，Frame Check Sequeence 添加到包得最后，为了判断数据包时候由于噪声而破坏；


#### 数据链路的包处理

![](/image/g.png)

每个包得首部都包含两个信息，一个是接收端和发送端的地址，另一个是上层的协议识别，每个分层的包首部中都有一个标明上一层协议的识别位。

#### 接受数据包与处理

* 接收的流程是发送流程的逆序，主机收到发送端的包以后，会查看以太网首部的接收端MAC地址如果不是自己则丢弃数据，如果是自己就查找首部的类型域从而确定以太网协议传送过来的数据类型为什么，这个例子中为IP包，将此数据传送给处理IP包得子程序，以太网首部类型域如果是ARP，则传送给ARP处理，如果无法识别，就丢弃数据；

* IP模块收到以后也做类似的处理，对于有路由器的情况下，接收端地址往往不是自己的地址，此时，需要借助路由控制表，在调查应该送达的主机或者路由器之后再进行转发数据；

* TCP模块的处理：首先计算一下校验和，如果数据没有破坏，检查是否按顺序接收数据，最后检查端口号，确定具体的应用程序，接收完毕之后，接收端发送一个"确认回执"，给发送端，如果发送端没有收到则会认为没有抵达，所以会一直反复发送，数据完整的接收以后会传给端口号识别的应用程序；

* 应用程序的处理：通过解析发送过来的数据可以获知邮件的收件人地址是乙的地址，主机B上没有地址的话会告诉发送端无此地址的错误信息；，正常的话发送一个回执给发送端也；

SNS(Social Network Service)，中文叫做社交网络，是一种即使共享，即使发布消息给特定圈内人的服务，所有设备比如电脑手机平板等在开机的时候就被运营商设立的具体的IP地址，启动应用程序时候连接制定服务器通过用户名和密码验证，这样服务器上积累的信息就传送给移动端上，并有该终端显示具体内容，都是TCP/IP的应用。


##### <a href="http://book.douban.com/subject/24737674/">参考《图解TCP/IP》</a>
