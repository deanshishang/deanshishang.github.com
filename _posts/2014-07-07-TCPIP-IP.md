---
layout: post
title: IP协议及其相关技术
category: Note
---

IP协议 主要负责将数据包发送到对端的计算机，可以让任何计算机之间进行通信；

### IP即网际协议

TCP/IP的心脏是互联网层，这一层主要协议时IP与ICMP(Internet Control Message Protocol)；

网络层的主要作用是实现点对点的通信，数据链路层的作用是在同一种链路的情况下进行通信，跨越多种链路的情况下是网络层；

主机与节点：主机就是有自己的IP地址并且不进行路由控制(Routing 中转分组数据包),即配有IP地址又由路由功能的叫做路由器，两者都称之为节点；

数据链路层提供的时两个设备直连的通信功能，网络层的IP负责没有直连的网络之间进行通信传输；

这个例子就比如，一个旅行社给你制定了详细的行程单这个行程表就是IP层点对点的通信，同时，过程中的火车票与飞机票段段分开的时相当于多个数据链路，只负责某一区间的的通信；

![](/image/ipa.png)

上图表明，两者兼备，才能到达目的地，这与此道理是相同的，没有数据链路，光有目标，不知道搭乘什么工具过去，只有工具的话，不知道该坐什么车，到哪里换乘；

### IP基础知识

IP大致分为三大作用模块，IP寻址，路由(最终节点为止的转发)，IP的组包与分包；

#### IP地址属于网络层地址

MAC地址用于识别同一个链路中的不同计算机，IP地址用于识别出连接到网络中每台主机的通信目标地址，通信中的所有主机或路由器都要设定自己的IP地址，在网桥或者集线器这些物理层或者数据链路层数据包转发设备中，不需要设置IP地址，这些设备只是负责将IP包转化为0，1比特流转发或对数据链路帧的数据部分进行转发，而不需要应对IP协议；

#### 路由控制

路由控制是将分组数据包发送到目标地址，即使网络非常复杂，也可以通过路由控制确定到达目的地址的通路，一旦这个路由控制的运行出现异常，分组数据极有可能迷失，无法到达目的地址，一个数据包能够完整的到底目的地址全部靠的时路由控制；


##### 发送数据到最终地址

IP路由叫做多跳路由，一跳就是一个网络区间，在每一个区间内决定包在下一跳的被转发路径；一跳的范围就是利用数据链路层以下的功能传输数据帧的一个区间，电缆可以通过网桥或者交换集线器相连，不会通过路由器或者网关相连，也就是说一个MAC到另外一个MAC地址之间，不发生跳跃；

多跳路由是指路由器或者主机在转发Ip数据包的时候指指定下一个路由器或者主机，而不是将到最终目标地址的所有通路全部都指定出来，因为每一个区间在转发Ip数据包时会分别指定下一跳的操作，直至包到达最终的目标地址；

这个例子就相当于乘火车旅游，你知道了目标地址，但是一开始不知道怎么换乘，你就到一个车站问乘务员，他告诉你下一站到哪里，到了下一站再咨询那里的乘务员，所以即使你不知道最终目的地的方向也没有问题，因为到达下一站会告诉你类似的建议；

IP包被转发到途中的某个路由器上时实际上是装入数据链路层的数据帧以后再被送出，上边例子中，IP包就相当于旅行者，路由器就相当于中转站和乘务员，每到一站，就会告诉你下一个段区间怎么走，反复多次就找到了目的地；

##### 路由控制表

每个主机都有一张路由控制表，记录IP数据下一步应该发送给哪个路由器

![](/image/ipb.png)

#### 数据链路的抽象化

数据链路层的地址可以抽象化为IP地址，所以不管链路层使用以太网还是无线LAN还是PPP都一视同仁；

不同数据链路最大区别就是最大传输单位MTU不同；在以太网中是1500字节，FDDI是4352字节，为了解决这个问题，将大IP包分成较小的包，分片的包到了对端地址以后会再组合起来传递给上一层，IP层指按着发送的长度接收数据包，这种方式抽象了数据链路层；

#### IP数据面向无连接型

对于一台主机来说，何时来多少哪里来的数据包都不清楚，应该进行网络监控，让主机只接收发给自己的数据包，IP层只负责将数据包发送到最终目标地址，TCP段负责最终确定收到内容；

### IP地址的基础知识

IP地址是32位整数，在计算机内部是二进制表示，为了方便，将每8位分成一组，即四组，通过.分开；

IP地址不是以主机台数配置的，而是以网卡数量，多个网卡配置多个IP，一个网卡也可以配置多个IP地址，所以IP地址2的32次方43亿并不能满足；根据一种可以更换IP地址的NAT技术，连接计算机数字超过43亿台；

#### IP地址由主机和网络部分组成

192.168.128.0/24 24表示到多少位结束为网络地址；

网络标识在相互连接的每个段的地址不相互重复，而相同段内的主机必须具有相同的网络地址，不允许在同一个网段内重复出现主机标识；

![](/image/ipc.png)

IP包转发到路由器的时候利用目标地址的网络标识进行路由，不关心主机标识；

从第几位结束是网络标识通过子网掩码进行区分，以前是通过分类区别；

![](/image/ipd.png)

#### IP地址的分类

通过IP地址的前四位的比特对网络标识和主机标识进行区分；

A类 首位为0开头 网络地址范围 0.0.0.0 -- 127.0.0.0 前八位是网络标识，后24位为主机标识，16777214个；

B类 首位10开头的地址 网络地址范围是 128.0.0.1 - 191.255.0.0 前16位是网络标识，后16位为主机标识，65534个；

C类 首位110开头的地址 网络地址范围是 192.0.0.0 -- 239.255.255.0 前24位是网络标识，后8位是主机标识，每个网段254个；

D类，没有主机标识，多用于多播，1110开头，224.0.0.0 -- 239.255.255.255 ；

分配地址的时候注意，用比特表示主机地址时候，不能全部0或者1 全部1是广播地址 全部0只有在表示对应的网络地址或IP地址不可获知的情况下使用，这也是C类为什么是254个了；

#### 广播地址

当IP包以数据帧的方式发送时候，得通过MAC地址全为1的FF：FF：FF：FF：FF:FF转发；

用于在同一个数据链路中发送数据包时候，就爱那个IP地址的主机部分全部设置为1就是广播地址；

广播分为两种一种是本地广播一种是直接广播，前者本网络之内广播例如网络地址为192.168.0.0/24，广播地址是192.168.0.255，这个广播地址会被路由器屏蔽，所以不会到达192.168.0.0.24以外的链路上；后者在不同网段之间广播，网路地址为192.168.0.0/24向192.168.1.255/24目标地址发送IP包，收到这个包得路由器将数据转发给192.168.1.0/24 从而所有192.168.1.1--192.168.1.254主机都能收到这个数据包；

#### IP多播




