---
layout: post
title: 基于openwrt操作系统，mips体系结构的路由器设备学习一
category: openwrt
---

路由器大部分CPU采用的就是MIPS架构设计的，MIPS采用了RSIC精简指令集设计技术；

32位，高集成，高性能的处理器，MIPS在这个领域定位中最强(相比于arm的低版本性能强)；

###### 路由器芯片大部分采用的Soc(System on chip)设计，路由器厂家叫做RoC(router on chip)设计；这些厂家将内存控制，外围I/O，Switch芯片，Wi-Fi芯片，加密芯片，SATA接口，PCI-E接口，USB接口等集成到指甲大小的芯片上，功耗只有1到3W，性能达到了400到800MHz，也有公司开始采用ARM架构；

Atheros公司是路由器芯片的顶级公司，MIPS32位架构设计，国内配套的产业链不够完善，并且其一款经典芯片跟TP-LINK穿一条裤子限制卖给其他厂商，被高通收购；

Broadcom公司产品稳定可靠，小米的第一代路由器采用这个处理器，ARM架构，Broadcom其他大部分都是MIPS架构，该公司的问题是，国内对合作厂商要求极高，小公司不搭理，二是芯片发热量很大；

Ralink公司是中国台湾地区，不论是产业链还是开发资料在国内都很成熟，芯片价格也很便宜，这个厂商的问题是不注重openwrt的项目，并且重要的驱动代码不开源，2011年被联科发收购，目前产品线已经完全切换到MTK品牌。

##### 常见路由器硬件规格

处理器         MIPS32位架构(无FPU即浮点运算单元)，ARM(很少)

主频           400Mhz到800Mhz等

内存类型       SDRAM，DDR1，DDR2

内存容量       16到256MB都有，常见的是32/64/128

存储器类型     SPI FLASH/NOR FLASH/NAND FLASH

存储器容量     4到128MB都有，常见的是SPI FLASH

交换机         集成在芯片里或者外挂

WIFI           芯片内置完整的WIFI或部分外挂

支持操作系统   LINUX,VxWorks


NOR flash 是最早的用于嵌入式的存储技术，读取速度接近内存，写速度稍慢；
NAND flash 是目前使用最多的存储实际，手机，Ｕ盘，ＳＳＤ硬盘等都采用，容量较大，路由领域使用少；
SPI flash 使用最多在路由器领域，读速比ＮＯＲflash稍慢，写速度比ＮＯＲflash快很多。

以前的路由器都是用现成的芯片，公司会提供源代码，各种资料，包括电路版设计图纸，开发ＳＤＫ等，很完善，现在有的路由器小厂商使用违规的大功率信号放大装置，国内的ＷＩ-ＦＩ污染很严重；

现在的智能路由器大多数采用openwrt这个开源的路由器操作系统作为自己的系统，然后对系统进行修改，做个自主的产品；

##### 路由器基本电路

不论路由器不变化多大，一定遵循的原则是"cpu带的不外挂芯片"或者“cpu不带的外挂芯片”

ＣＰＵ：主流的路由器ＣＰＵ基本使用ＢＧＡ或者ＱＦＮ封装；

内存：ＳＤＲＡＭ采用ＴＳＯＰ封装，ＤＤＲ1也是ＴＳＯＰ封装，ＤＤＲ2与ＤＤＲ3采用ＢＧＡ封装；可察看内存的幸好，内存采用bit表示，1024Ｍbit，就是128ＭＢ；

存储器：现在大部分都采用ＳＰＩ接口的ＳＯＰ8或者ＳＯＰ16封装flash；

其他：除了上述的ＣＰＵ，内存，存储器之外有电源模块，没有多余的芯片了，如果有，应该就是ＣＰＵ没有集成的所需要的那个功能；

##### 认识Ｂootloader

做的是一些基本的外部电子设备的检测，同时完成ＣＰＵ要求的初始化，再启动Ｆlash上的Ｌinux内核；Ｕ-boot是的过ＤＥＮＸ小组开发，成为atheros(高通)，Ｒalink(联科发)产品的标配引导系统；

##### 硬件启动

ＣＰＵ厂家提供ＳＤＫ里完善的东西，不需要修改太多，系统到底咋启动的呢？


上电--->晶振发起频率抖动--->CPU启动内部代码--->Uboot启动--->Uboot根据参数设置倍频--->Uboot进行一些其他的内部寄存器配置--->Uboot启动操作系统

设备上电以后，晶振开始发起一个制定频率的震动，这个时候CPU就根据晶振的频率进行了启动，CPU在晶振频率下启动自己的内部代码(CPU内有一段小代码和一点点内存，用来做最基础的事情，并且查找Bootloader在哪里)，然后启动Uboot,最后进入操作系统，换个说法就是：汽车打火的时候需要启动机，启动以后，只要给发动机油，就可以高速运转，CPU也是这个原理；

注意：Openwrt AA 版本是指，attitude_adjustment；


