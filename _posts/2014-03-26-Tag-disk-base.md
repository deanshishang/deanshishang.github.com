---
layout: post
title: 磁盘,闪存小知识
category: Tag
---

### 磁盘

安装系统至少分成两个区，将系统文件与数据文件分开，一个磁盘最多可以四个主分区或者三个主分区加一个扩展分区；

主板上通常有两个电缆接口为IDE接口，为主从接口每个接口有两个插槽，能接四个IDE设备，通过跳线调整区别主从；

磁盘进行分区的时候，每个分区就是一个文件系统，每个文件系统开始的地方叫做超级块，磁盘的最小存储单位是扇区，数据存储的最小单位并不是扇区，而是格式化磁盘时候定义的逻辑块，增大逻辑快会减少磁头的读取次数，但是小文件的时候就会浪费空间；

分区的要点就是记录从哪一个柱面到哪一个柱面结束，记录这个的数据在MBR主引导分区中，计算机要使用硬盘第一个读取的位置，记录了分区数据信息，以及启动时候写入引导程序的位置；

硬盘其实就是多个圆盘组成到一起的，硬盘里边有磁头在进行读写，磁头转了一圈就是磁道，同一半径的磁道组成的是柱面，柱面里边又分多个扇区，扇区的大小为512Bytes 柱面是硬盘分区的最小单位，扇区是最小的存储单位；

硬盘大小的计算应该就是，headerXcylinder/headerXsector/cylinderX512Byte，对于硬盘分区来说，操作系统要知道哪个柱面到哪个柱面是可以操控的，分区就是记录每个partition的起始与结束柱面；

在磁盘分区的时候，每个Partition就是一个文件系统，这个partition最一开始的block就是超级块，记录了分区的大小，空的和填满的块以及他们的位置等信息；

#### 文件系统：

linux的文件系统规划出了inode以及block分别来存储档案的属性以及档案的内容，Inode出了记录档案的属性信息之外，还具有指向功能，即指定了档案存放的位置，linux如何读取目录或者档案的内容呢？建立目录的时候会分一个Inode和至少一个block，分别记录属性信息以及目录下档案或者目录的关联性，建立档案的时候分一个inode和对应大小的block，主意文件名并不是记录在inode中，而是对应目录的block区里，当读取一个档案的时候，linux会先读取该目录的上层目录的Inode，然后根据block中记录的关联性，去的该档案的inode，通过inode指定的Block来读取档案；

磁盘在格式化的时候会分出来两个区域，即inode和block；

磁盘在格式化的时候，Inode和block大小就固定了，一半block大小为1024/2048/4096bytes，一般来说每4kbyte分配一个in ode，对于一个档案来说，block=1024byte时候，文件大小达到16G, 4096时候可以达到2TB,对于一个Partition来说，block=1024byte时候，达到2TB,4096时候，达到32TB;

异步处理方式：比如一个档案的读取，该档案所在的区块会加载到内存当中，所以这个时候磁盘的区块就会被放置在主存储器的缓冲快取区域内，若这些区块的数据被改变时候，刚开始仅有主存储区数据会被改变，这个时候在缓冲区中的区块数据会被标记为dirty，表示这些区块的数据必须回写到磁盘中，以保持磁盘的区块和主存储器的区块数据一致；

挂载点的意义：如果要使用我们的Linux系统，必须挂载上linux系统才可以，那个入口点目录就是挂载点，#ls -lid

文件系统的简单操作：du df 的使用

磁盘的分区格式化检验挂载:fdisk mke2fs -j

sync:完成磁盘数据回写

mount 挂载：设置好/etc/fstab之后，如果输入错误，进入单人维护模式，这个时候是只读的，怎么办呢？$ mount -n -o remount,rw / 时机的filesystem是记录到/etc/mstab 和 /proc/mounts 这两个档案中的；

大档案的挂载，手动的一个2G的文档，建立一个空的档案在/dev/loopdev：
dd if=/dev/zero of=/dev/loopdev bs=1024k count=2048


### 闪存

1. 闪存芯片的读写单位不同，应用程序对nor flash的读写是以字为单位，字是指处理器一次所能处理的字节数叫字.但是在不同的厂家对字的定义不一样.intel架构把16bit定义成一个字,而苹果则把32bit叫做字,16bit叫半字.我们通常是基于intel架构,所以一般说字就是指16bit.字节则都是8bit.一般为128kB或者64kB的逻辑块，有时候块内还会分成扇区，读写的时候添加块的地址以及块内的偏移量；对nand flash 是以块为单位，块比较小一般为8kB，每块分成页，页的大小为512字节，要是修改一个字节，必须重写整个数据块；

2. nor 是随机存储介质，一般用于数据比较小的场合；nand是连续存储介质，适合存放大的数据；

3. nor 是数据线与地址线分开，传输效率比较高，可执行程序可以在芯片内执行，不必把代码读到内存当中，嵌入式系统经常将nor作为启动芯片，nand数据线和地址线共用，nand只能对一个固定大小的区域进行清零，nor可以对字进行操作。

4. nand的容量大，存储空间是二维的，块和页，每页有16字节存放错误校验码，OOB，写操作的时候先放入缓冲区，然后有写指令，进行写操作，向nand写大量数据的时候，效率是比nor高的。

5. nor可靠性高，结构简单，两者相比较来说，都需要先擦后写，nor要擦写一个字，nand擦写整个块，nor寿命长，两者的写操作不仅仅是物理上的操作，必须使用算法实现，一般在驱动程序的mtd memory technology driver 中实现。

6. 大容量多媒体文件使用nand闪存，数据程序存储中用nor闪存。

