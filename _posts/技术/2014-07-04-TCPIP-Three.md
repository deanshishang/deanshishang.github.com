---
layout: post
title: 数据链路
category: 技术
tags: Note
keywords:
description:
---

TCP/IP的具体数据链路，比如以太网，无线局域网，PPP等；

### 数据链路的作用

数据链路层的协议定义了通过通信媒介互联的设备之间传输的规范，通信媒介包括双轴线，同轴电缆，光纤，电波以及红外线等，各个设备之间有时也会通过交换机，网桥，中继器等中转数据；

把电压的高低灯光的闪灭转换成0，1序列是物理层的责任，数据链路层出来的数据也不是单纯的0，1，而是把他们集合成一个叫做帧的块，然后再进行传输；

链路层的相关技术，比如MAC寻址，介质共享，非公有网络，分组交换，环路检测，VLAN(Virtual Local Area Network虚拟局域网)等，数据链路视为网络传输中最小的单位；

在以太网与FDDI(Fiber Distributed Data Interface,光纤分布式数据接口)规范中，定义了链路层和物理层的协议，而在ATM(Asynchronous Transfer Mode，异步传输方式)，也规定了网络层的一部分；

数据链路的段：从网络层来看，两个网线根据中继器连接起来，组成一个网络段，物理层角度就是两个物体的连接，两根网线就是两个段：

![](/image/sa.png)

### 数据链路的作用

#### MAC地址

用于识别数据链路中互连的节点，以太网和FDDI中规范(IEEE802.3)使用MAC地址，其他的无线LAN(IEEE802.11a/b/g/n)使用同样规格的MAC地址；

MAC地址长48比特，不论在何种数据链路的类型中(以太网，FDDI，ATM，无线LAN，蓝牙等)，都不会有相同的MAC地址，不过也不是一定的，比如如果在一台主机上虚拟多个虚拟机，由于没有硬件识别智能通过软件来识别自己设定Mac地址，给多个虚拟网卡，就有可能不是独一无二了，事实上只要不属于一个数据链路就不会出现问题；

#### 共享型介质网络

从通信介质的使用方法来说分为共享型和非共享型的介质网络，前者指多个设备共享同一个通信介质的网络，这种方式下设备之间使用同一个载波信道进行发送和接收，最早的以太网和FDDI就是这种方式，基本上采用半双工通信，并有必要对介质进行控制访问，有两种，争用方式和令牌环传递方式：

争用方式指夺取数据传输的权利，指用CSMA(载波监听多路访问)，先到先得的方式传输数据，多个站同时发送数据帧的话就会网络拥堵，产生网络拥堵，改良后的叫做CSMA/CD方式：

![](/image/sb.png)

![](/image/sc.png)

令牌传递方式，是沿着令牌环发送一种叫做令牌的特殊报文，只有获得的才能发送数据，一可以不造成拥堵，二可以每个站都有同时获得令牌环的机会：

![](/image/sd.png)

#### 非共享型介质

指不共享型介质，网络中的每个站连接交换机，通过交换机接收和发送数据帧，发送与接收端不共享介质通信，很多情况采取全双工通信，这种方式可以更具交换机构建虚拟局域网(VLAN),进行流量控制，这种方式的知名弱点是交换机坏了就无法通信；

![](/image/se.png)

#### 根据MAC地址转发

将集线器或集中器等设备星型连接，出现了新的网络设备，这是一种将非共享型网络的交换机用在以太网络中的技术，交换集线器也叫做以太网交换机，就是持有多个端口的网桥，他们根据数据链路层中每个帧的目标MAC地址，决定从哪个接口发送数据，记录这个对应关系的表叫做转发表；

转发表中得内容不需要在终端或者交换机上手工设置，而是可以自动生成，数据链路层中的每个点在接收到数据包的时候，会从中将源MAC地址以及曾经接收该地址发送的数据包的接口作为对应关系记录到转发表中，以某一个源MAC地址发送的包由统一一个接口接收，也可以说，以该地址为目的地址的包，经由该出口送出即可，这个过程叫做自学；

由于MAC地址没有层次性，转发表中的入口数和设备数量有关，当设备数量增加的时候转发表也会增大，检索时间越来越长，这样要采用类似IP地址分层的进行管理

![](/image/sf.png)

交换机的转发方式有两种，一种是直通转发，一种是存储转发，直通转发就是不需要将真个帧接收下来，知道目标地址就转发有延迟段的特性，同时不能避免发送错误帧，存储转发检查以太网数据帧的末尾FCS位后再转发，保证不破坏帧

#### 环路检测技术

一旦出现环路通过网桥连接，如何处理，一是网络拓扑结构，二是网桥种类都有关系，最坏的情况就是数据帧一直转发，这样多了就会造成网络拥堵，为了解决环路问题，使用了两种方法，源路由方式和生成树方式，就能避免问题

#### VLAN 

在进行网络管理的时候，时常会遇到分散网络负载，变换网络部署位置等情况，在做这些修改的时候，不得不修改网络拓扑结构，进行硬件线路改造，VLAN技术的网桥添加到2层交换机上，就可以切断所有的Vlan之间的通信，不用修改网络布线，直接修改网络结构就可以了，即使连接到同一个交换集线器，也可以划分不同的网络，Vlan把交换机多个端口分成了不同的网段，从而区分了广播数据传输的范围，减少了网络负载，并且提高了网络的安全性，然而在异构的两个网段之间，需要利用具有路由功能的交换机在各段之间进行通过路由器连接才能实现通信。

### 以太网

众多数据链路中，最著名的就是以太网;

![](/image/sg.png)

在传输速度相同而传输介质不同时，应该采用允许更改集线器和中继器的设备；传输介质相同而速度不同的时候，必须采用允许变更速度的设备如网桥交换集线器或者路由器；

![](/image/sh.png)

#### 以太网的帧格式

--------

### 无线通信

无线通信使用电磁波，红外线激光等方式进行传输；

#### 无线传输的种类

![](/image/si.png)

#### IEEE802.11

定义了无线LAN协议中物理层与数据链路层的一部分；

介质访问控制层使用了与CSAM/CD相似的CSAM/CA方式，通常采用无线基站并通过高基站实现通信，现在各个厂家开始开发销售具有网桥功能的基站设备；

![](/image/sj.png)

![](/image/sk.png)

![](/image/sl.png)

#### IEEE802.11b IEEE802.11g

定义了2.4GHz频段中无线局域网的标准，最大的传输速度达到11Mbps 与 54Mbps，在价值访问控制层使用CSMA/CA方式，基站作为中介进行通信，距离30到50米；

#### IEEE802.11a

物理段利用5GHz频段，达到54Mbps速度，不使用2.4GHz频段，不产生冲突；

#### IEEE802.11n

g和a的基础之上，采用同步于多条天线的MIMO技术，实现高速通信的一种标准，物理层使用2.4或5Ghz频段；不受2.4Ghz干扰的话，n 带宽可以达到bga的几倍(40Mhz) 最大传输速度是150Mbps，

#### 其他

蓝牙(3Mbps)，WiMAX(最后一公里)，ZigBee(短距离，低功耗，家电控制)；

### PPP(Point-to-Point)，点对点，一对一连接计算机的情况，相当于数据链路层；

仅有PPP无法实现通信，还需要物理层的支持，因为它不像以太网和FDDI一样与链路层和物理层都有关，它属于纯粹的数据链路层与物理层没有任何关系；

可以使用电话线或ISDN，专线，ATM路线，近些年用ADSL或者有线电视通过PPPoE(over Ethernet)实现互联网接入，是在以太网的数据中加入ppp帧进行传输的方式；

#### LCP与NCP

开始进行数据传输的时候，建立一个PPP级的连接，连接建立以后就可以进行身份认证压缩和加密；

PPP中包括连个协议，一个是不依赖上层的LCP协议(Link Control Protocol)，如果上层为IP层，此时的NCP叫做IPCP(IP control protocol)，依赖上层；

LCP负责建立和断开连接，设置最大接收单元MRU，设置验证协议(PAP或者CHAP)以及设置是否进行通信质量的监控；IPCP负责IP地址设置以及是否进行TCP/IP首部压缩等设备；

![](/image/sm.png)

通过ppp连接的时候一般需要进行双方的验证，验证协议有两种PAP和CHAP,前者在连接时通过两次握手进行用户名密码验证，用于安全环境并不高的场合，因为密码是明文的；后者则通过使用一次性密码(One Time Password)，可以有效的防止窃听，建立连接后定期的进行密码交换;

#### PPP的帧格式

这种方式给计算机带来负荷很大,通过电脑拨号的时候，PPP在软件中实现，那些插入删除或FCS计算都交给计算机处理；

![](/image/sn.png)

#### PPPoE 

这种互联网接入功能中，通信线路由以太网模拟，单纯的以太网没有验证功能，没有建立连接断开的操作，无法按时计费，使用PPPoE ISP就可以管理控制终端用户的使用；

### 其他数据链路

* ATM 线路占用是间短高效传输大容量数据用于广域网的连接：

* POS（Packet over SDH/SONET）

* FDDI 分布式光纤数据接口

* Token Ring 令牌环网

* 100VG-AnyLAN

* 光纤通道 实现高速数据通信，主要数据链路，广泛用于搭建SAN(Storage Area NetWork)

* HIPPI 传输距离在25米内，连接超大型计算机

* IEEE 1394 面向家庭的局域网 用于连接AV等计算机外围设备，数据传输速率为100到800Mbps，

* HDMI 高清晰度多媒体接口

* ISCSI 电脑连接硬盘的SCSI用于TCP/IP网络的一种标准

* InfiniBand 针对高端服务器的一种接口

* DOCSIS 有线电视传输数据的行业标准

* 高速PLC 家里或者办公室利用电力线，用于室内使用

![](/image/so.png)

### 公共网络 公共通信服务

##### 模拟电话线路

利用固定电话线路通信，猫的传输速率太小了逐渐被淘汰

#### 移动通信服务

只要在服务器内就能用到服务商提供的服务，手机和小灵通等，以前速度慢 现在有速度更快的LTE等技术

#### ADSL

对已有的模拟电话线路扩展的一种，每个话机到电信局交换机之前这段线路可以实现高速传输，ADSL利用这个段，附加上一个叫做分离器的装置，将音频信号和数字信号隔离以免产生噪声干扰；

![](/image/sp.png)

#### FTTH(Fiber To The Home)

一根高速光纤直接到达用户家里，速度受运营商限制

#### 有线电视

有线电视接入互联网，这种方式通过利用空闲频道传输数据实现通信。

#### 专线

一对一的连接

#### VPN 

用于连接距离较远的地域，包括IP-VPN 广域以太网络；

IP-VPN 在网络上使用多协议标签交换技术，构建VPN服务，在IP包中附加一个叫做标签的信息进行传输控制，每个用户标签信息不同，可以判断出目标地址，这样一来可以将多个不同用户的VPN信息通过MPLS区分，形成封闭的私有网络，还能进行用户带宽控制；除了使用提供商提供的IP-VPN服务之外，有时候企业还可以在互联网上建立自己的VPN，一般采用IPsec技术，这种方式对包进行加密，在互联网构建一个封闭的私有网络；

广域以太网 用于连接距离较远的地域一种服务，在数据链路层上利用VLAN实现VPN技术；

#### 公共无线LAN

公开的WIFI，服务提供者在人员相对集中的地方假设一个叫做热点的无线电波接收器，上网时候先通过这些热点建立连接，连接以后还可以通过VPN连接到自己公司的内网；

#### 其他公共无线通信服务

* X. 25 电话网的改良版

* 帧中继 对上者进行简化，用于以太网和IP-VPN中 在减少

* 综合业务数字网，ISDN ，综合公共网络中应用


##### <a href="http://book.douban.com/subject/24737674/">参考《图解TCP/IP》</a>
