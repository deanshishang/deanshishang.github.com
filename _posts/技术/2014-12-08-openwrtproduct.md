---
layout: post
title: Openwrt路由器产品的方案定制要求
category: 技术
tags: Openwrt
keywords:
description:
---

如何把无线路由器的最基础的网络传送工作做好？

为了用于体验更好，个人认为最重要的三个工作是：

* 无线较高的传输速率

* 较高的并发人数

* 设备的工作稳定性

射频的质量对上述三个指标影响很大；

##### 数据的传输速率

为了向用户直观的表示数据传送能力，标称的54Mbps,150Mbps,300Mbps,现在基于IEEE802.11ac的无线路由器已经标称1300Mbps了，对于非专业的来说，肯定会拿这个速率来跟以太网的100M以及1000M来对比，认为150Mbps的路由器肯定大于100M交换机的传送能力，但在实际体验中落差是非常大的；

150或者300这个数字表示的不是时时刻刻能达到的速度，而是它最大能达到的传输速率，无线通信与有线通信的最大差别在于，无线环境的信号传送环境是不稳定的，为了兼顾信号传送的成功率和传送效率，无线通信普遍采用动态的信号调制方案，导致数据的传输速率不停的变动，综合下来，平均速率肯定远低于最大传输速度；

关于信号调制方案打个比方：

小明给小平写情书，一个在男生楼，一个在女生楼，小平为了早点看到情书，通过望远镜来瞄准小明寝室，让小明把情书直接贴在窗户上，这就是无线通信，小明的纸张一页上最大的输入字是150/页，情书是要传送的信息，汉字就是传送的信号，白纸是传送的码元，窗户就是信道，最好的时候可以写150个字，但是有雾的时候就只能写6个字，时好时坏的天气导致平均每页写30个字，小明根据天气情况在纸上写不同的字就是小明在确定信号的调制方案，所以信号的调制方案对信息的传输速率影响很大；

射频质量如何影响传输速率？

小明给小平写情书，如果字体特别粗或者笔记潦草较轻，这样小平就不容易看清楚，小明不管是放大字体(这样降低了调制效率)，重新写一遍(信号重传)，不管哪一个方案都影响谈情说爱，降低了信息传输速度，而最好的解决方案就是字体写的清楚一点，这样传输速就快了；

射频质量就是影响信号质量的最直接因素，直接影响传输速度，射频的参数比较多，最直接的三个是：

* 发射功率：信号的强度，也就是小明写的字体是否足够深，轻的话小平不容易看清楚；

* 误差向量幅度EVM：就是信号的调制质量，也就是小明写的字是否工整笔画是否清晰，如果小明说：我不会三心二意，结果小平看成：我不会一心一意，麻烦就大了；

* 接收灵敏度： 就是小平望远镜的玻璃是否清晰，如果透光率不好的话，即使字迹再工整，笔画再深，就没法看清楚，只好又写大字，那谈起来太煎熬了；

总结一下：当小明的字迹比较深(发射功率高)，笔画工整(调制质量好)，小明可以在一张纸上写更多的情话(调制效率)，这样谈情说爱(信息传输)速度就高很多了，反之的话小平距离远的话，就快洗洗睡吧！

##### 并发连接人数

小明小平卿卿我我，寝室的其他人也坐不住了，但是窗户就只有一个，一次就能放一张纸，怎么办呢，轮流上吧，这个时候就出现并发问题了，指能够同时有效通信的容量，如果小杰惹小丽生气了，小杰道歉，小丽半个小时才贴出来看到，那小丽早就找别的oba了。

刚才讲的汉字是信号，白纸是码元，窗户是信道，但信息的传输速率怎么算呢？一个窗户是一个信道，一个窗户一小时内可以贴出20张白纸(码元)的话，那么码元的传输速率(波特率)就是20张/小时，一张纸最多写150个字(信号)，最低写6个字，那么信号的传输速率(比特率)就是最高3000/小时，最低是120/小时；

假定每个男生和女生的会话中，男生给女生每小时1封信(帧)，每封信200字，这个时候看一下并发容量。如果女生没住的近，每张纸可以写150字，这样小明和小平谈情就需要两张纸，第二张只写50个字，小杰和小丽也只需要两张纸，20除以2(码元传输速率)，那么每个小时可以最多允许10个会话，也就是用户容量是10，这个时候是皆大欢喜的。但是女生住的远的话，男生的笔记又潦草(调制质量差)，结果每张纸上只能写54个字，那么小明和小平就需要四张纸，那么容量就变成了5，如果墨水质量差(发射功率低)，那么每张纸只能写6个大字，一个小时的窗户(信道)全给小明，小明也无法表达对小平的爱恋，用户容量是0，大家就掉线了。

实际的情况更复杂，窗户就一个，男生们并不是排排队分果果，而是抢着是用窗户(信道)，男生们制定的规则是，谁有信(帧)谁就先发送，如果有超过一个人同时到窗户边，大家就都下来喘口气，然后再冲上去抢窗口，知道有一个人抢到，他可以把信的每页纸(码元)连续贴到窗户上，知道贴完，然后他下来，大家重新抢占，这就是80211的CSMA/CA机制；

可以看到每张纸写的字比较多（调制效率高）时，小明可以迅速的向小平表达爱意，然后把窗口让出来，下来从容的写第二封信，小明的任务比较轻松（CPU占用少），同样，寝室的8个男生也都很嗨皮，只是偶尔有两三个兄弟一起冲到窗前，就一起下来让窗户空一会，一个小时贴16张纸一点不紧张。但天有不测风云，红太郎搬到比较远的地方，而寝室的墨水和毛笔是劣质品（射频质量差，发射功率不足，调制信号不清晰），灰太狼一页纸只能写54个字，寝室的和谐气氛打破了。灰太狼用了4张纸，他占用窗口的时间长了，其他兄弟能够使用窗口的时间就紧张了，于是在他下来时，马上有三个兄弟冲到窗前，大家下来喘口气又抢，结果现在四个兄弟冲到窗前，大家又下来喘口气。反复几次喘口气，耽搁了窗户贴纸的时间，最后在一个小时内，只有6个兄弟发出了信。红太郎搬家，导致小明、小杰和女朋友闹别扭，所有兄弟都因为忙着抢窗户而感觉身心疲惫。寝室的兄弟很生气，虽然把灰太狼赶出去，其他7个兄弟就可以继续嗨皮，但是兄弟一场，不能这样办，于是乎大家凑钱买了质量好的墨水和毛笔，让灰太狼可以一页纸写150字，寝室又进入宁静和谐的状态。

总结一下：如果使用劣质笔墨(射频质量差)，那能够同时通信的兄弟数量就会大幅减少，这是因为当传输速度低导致窗口(信道)资源紧张时，抢占窗口的冲突就会快速上升，翻过来造成窗口的资源浪费增加，资源更加紧张，呈现恶性循环，最简单的改善方法，就是更换优质笔墨，也就是更好的无线路由器；

##### 运行稳定性

如果大家不愿意掏钱买优质的笔墨会怎样呢，寝室8个人都想写信，你争我抢，抢的上气不接下气，大家都很疲惫，但不管怎么抢，还是有不幸的两三个人贴不出去信，让女朋友觉得不关心她，这时候可恶的灰太狼相处了坏主意，虽然一个纸可以写出54个字，但是为了避免抢不到窗口，他也不长篇大论了，只在纸上写了"红太狼我爱你"，窗口一空闲，他就抢着贴出去，小杰小明也跟着学，由于小包增多，大家抢窗户更激烈了，还不等一口气喘上来，就又冲上去(进程切换增多)，由于身体不好的小杰开始吐血了(进程异常)，小明和灰太狼也在争抢中摔坏了凳子(内存释放异常)，爬窗户更加费劲了，小明也开始吐血，大家忙着抢窗口，作业不写了，扑克不打了(任务阻塞)，最可怜的大熊，写了100张纸(缓存溢出了)还没有贴给小静看，大熊怒火中气，恶向胆边生，直接在屋子里点了一把火把信少了于是大家都跑了(系统崩溃)；

总结一下：如果用劣质笔墨(射频质量差)，会造成抢占窗口(信道)的开销更加剧烈增加，当开销超过系统的负荷能力，网络通信就完全无法保证，还将引起任务阻塞和进程异常，最后导致系统崩溃。

##### 总结

在通信强度不大的时候射频质量的影响还不突出，但是一旦并发用户多，通信强度增大，射频质量就有可能导致系统处于资源紧张中，势必影响用户并发容量，在系统资源消耗超越门限时，系统崩溃，可见，小小的射频是不容忽视的，尤其是在通讯热点区域部署时；

有人说了，说的那么邪乎，我家里100元的无线路由器用的挺好啊？这是因为家里的并发用户并不多，最多也就四五个，且受上行宽带接入带宽的限制，总的通信强度并不大。在资源不紧张时，大家都是比较从容的。又有人说了，那我买信号王不就成了，可是信号王是属黑李逵的，抡板斧那是好手（发射功率大），写情书不写斗大的字根本看不清（调制质量差），算是银样蜡枪头中看不中用了。

##### 定制时候可以按着需求走：

Openwrt
 
 提供支持Openwrt的电信级无线路由器整机或者模块。
  
 内存、Flash、存储
   
 定制不同的容量规格。
    
 有线、无线接口定制
	 
 定制接口数量，定制接口类型，例如航空接头。
	  
 定制环境适应性
	   
 包括防尘、防水、高温、低温、防雷、防震。
	    
 定制安规适应性
		 
 例如矿用本安认证、航空设备安全规范。
		  
 定制工作频率
		   
 将Wi-Fi无线宽带工作在行业专属频率上。
		    
 定制覆盖距离
			 
 提供100mW/500mW/1W/2W/10W不同发射功率的设备。
