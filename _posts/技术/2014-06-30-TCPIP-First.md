---
layout: post
title: Note - TCP/IP 之网络基础知识
category: 技术
tags: Note
keywords:
description:
---

### 计算机与网络发展的7个阶段：

* 批处理：batch processing.事先将程序拷贝到磁盘卡带里边，然后经过计算机读卡机读取顺序处理之后，数据一并批量处理;
* 分时系统：time sharing system.多个人同时使用一台电脑;
* 计算机之间的通信;
* 计算机网络的产生：基于分组交换计数的计算机网络;
* 互联网的普及：连接异构型计算机的通信网络技术;
* 以互联网为技术中心的时代;
* 从单纯建立连接到安全连接;


### 定义:

* 互联网是由多种通信技术统一融合而成，而tcp/ip技术就是使他们之间统一；
* cpu：中央处理器，计算机的心脏，每块程序都是cpu调度处理的；intel core.intel atom.arm cortex；
* os：操作系统，基本软件，cpu管理，内存管理，计算机外围设备管理以及程序的运行管理;
* 协议：计算机通信中相互之间有一个详细的约定，并按着约定遵循执行，就是协议；
* 分组交换协议：将大数据分为一个个为包为小单位进行数据传输；
* 协议的分层与OSI参考模型：上下层之间交互用的叫做接口，同一层之间的遵循的约定叫做协议；
* OSI参考模型：参考模型中定义了每一层的作用，每一层的作用通过协议来定制，协议是约定，其具体内容由规范来定制，我们日常使用的就是遵循各个协议的规范通信产品和通信手段;

### 参考模型中各个分层的作用:

* 应用层：为应用程序提供服务并且提供通信相关的细节，例如远程登录，文件传输，邮件发送等协议；
* 表示层：设备固有格式和网络标准格式之间的转换，主要负责数据格式的转换；
* 会话层：负责通信的断开和连接，负责传输层以下的管理，什么时间断开和什么时间连接以及连接多久；
* 传输层：管理两个节点之间的数据传输，只在两个节点上进行处理，不在路由器上，负责数据的可靠传输；
* 网络层：主要是将数据传送到目标地址，这一层负责寻址和路由选择；
* 数据链路层： 负责连接到同一个网络的两个节点之间的数据传输，数据帧与比特流之间的转换，将0 1 序列转化成有意义的数据帧传送给对端；
* 物理层：负责比特流0 1序列和电压的高低，光的闪灭之间的转换；

![](/image/cc.png)

### 参考模型的通信处理举例：发送电子邮件

#### 会话层以上的处理：
* 应用层：用户A在主机A上建立一封内容为"早上好"的邮件给B主机的B用户，输入邮件后发送给对端就是进入了应用层，点击发送的那一刻就是进入了应用层的处理，附有数据首部和数据正文的数据传送到对端，完成了应用层之间的通信，最终实现了邮件的存储；
* 表示层：将计算机特有的数据格式转换成网络的标准格式，表示层与表示层之间为了识别特定的编码格式，也会附加首部信息，方便下一层进行处理；
* 会话层：即采用哪个数据连接方法，比如发送五封邮件是没发一次建立一次连接还是一次性发送五封邮件，这就是会话层的作用，会再数据前端添加首部信息记录数据发送顺序；

#### 传输层以下的处理：
* 传输层：保证数据的可靠性传输，计算机两端会进行确认，如果没到就重发，建立连接，创建两台计算机之间逻辑上的通信连接是传输层的主要信息，也会在首部信息上加入以识别这一层的数据；
* 网络层：负责传输内容的一层，数据从A到B的通信处理，两端主机之间虽然有很多链路，但是从Ac传输到B地址都是网络层的功劳，目的地址是进行通信的唯一识别，网络层会增加数据首部包含目标地址以及数据一起发送给下一层的数据链路层，进行处理；


![](/image/aa.png)

* 数据链路层和物理层：网络层负责端对端的数据发送处理，数据链路层负责不同的区间内的通信，通信实际上是由传输介质上进行的，链路层的作用就是在这些传输介质之间进行数据处理，物理层将01转换成电压和脉冲光传输给物理的传输介质，相互直连的设备之间通过MAC地址来识别，这一层将包含MAC地址的信息首部传输给从网络层发来的数据上然后发送给网络；

![](/image/bb.png)

* 主机B端的处理：从物理层开始逐一由下到上进行处理，每个分层的协议上规定了数据首部的内容和首部以及数据处理的顺序；

### 传输方式的分类：
网络与通信中可以根据其数据发送方法进行多种分类，分类方法有很多。

#### 面向有连接的面向无连接的：
面向有连接的包括TCP,帧中继，ATM等，面向无连接的包括，udp,ip,以太网等，前者在通信传输前后要确定连接还是断开，就比如平时打电话一样，后者如同邮局邮寄包裹；

#### 电路交换与分组交换：
电路交换计数主要用于过去的电话网络，现在都是分组交换，TCPIP就是基于了分组交换技术，电话交换说白了就是专线专用，两台主机之间通信一直占用一根通道，其他主机想发送数据就得等待，还不知道等到什么时候，并发用户如果超过了交换机的线路总数，就根本无法实现通信，因此有了新的方法，建立通信连接的两台计算机之间发送的数据分成多个数据包，然后标记首发地址和顺序，这样所有的计算机可以一起收发数据，就是分组交换技术，这个技术中，计算机与路由器之间，路由器与路由器之间只有一条线路，也就是共享的，所以资源占用压力都在这个上边，发送接收速度不平均；路由器接收的数据都会缓存到队列中；

#### 根据接收端的数量分：
* 单播(Unicast)：一对一的通信，早先的电话就是单播；好比老师与单独学生对话；
* 广播(Broadcast)：一台主机发送给与之相连的所有主机，广播通信就是相当于电视信号，发送给多个接收对象，这个广播也有范围，好比校长对着全校学生讲话；
* 多播(Multicast)：与广播类似，只不过主要是多播限定某一组主机作为接收端，最主要的例子就是电话会议，多组人在不同地方进行会议；好比一个学校对单独一个班级进行内容分发一样；
* 任播(Anycast)：在特定的主机群中选择出一台来进行通信，任播通信会从目标主机群里选择一个最优的主机进行通信，收到的主机回发一个单播的信号，随后进行通信；应用主要由DNS根域名解析服务器，相当于老师想找一个人发作业，有一个人就来了；

### 地址：
打电话时，电话号码就是地址，发信件时，地址加上姓名就相当于地址，发送端和接收端就是用地址信息来区分，协议中每一层的地址含义都不一样，包括IP地址，Mac地址，Port端口，电子邮件地址等。

#### 地址的唯一性：
同一个通信网络中地址必须唯一;

#### 地址的层次性：
相当于电话号码包括国家区号，通信地址包含国名，省名等，方便于快速定位，MAC地址没有分层，对于寻址起不到作用，所以IP分层，实际寻址中必不可少，分层包括网络号和主机号，MAC寻址有转发表，IP寻址有路由表，MAC地址表记录的是实际的MAC地址，路由表中记录的IP地址是集中了的网络号与子网掩码，地址转发表和路由控制表都是自动生成；

### 网络的构成要素：
介绍连接计算机与计算机的硬件设备。

![](/image/dd.png)

![](/image/ee.png)

#### 通信媒介与数据链路
计算机之间通过电缆相连，包括双绞线电缆，光纤电缆，同轴电缆等，根据数据链路(相互直连的设备之间进行通信所涉及的协议及其网络)不通选择不通，媒介本身也可能是微波电波等；

![](/image/ff.png)

数据传输的过程中，两个物理设备之间数据流动的速度为传输速率，也称之为贷款，世界的传输速率称作吞吐量。

#### 网卡：

网络适配器，网卡，LAN卡，即网络接口卡(NIC),计算机连接网络的必须。

#### 中继器：

是物理层面上网络延长的设备，由电缆传过来的电信号或者光信号经由中继器的波形调整和放大之后传给另外一个电缆。

#### 网桥/2层交换机

数据链路层上连接网络的设备，能够识别数据链路层中的数据帧(与分组数据概念相同，在数据链路层称之为数据帧)并将其临时存储于内存，再重新生成信号作为一个全新的数据帧发给相连的另一个网段。数据帧中有一个数据位叫做FCS，用以校验数据是否正确送达目的器，值不对的话丢弃。这里所说的地址是MAC地址，硬件地址，物理地址以及适配器地址，也就是针对NIC分配的地址，这类功能是数据链路层的功能，即二层交换机；

以太网中经常使用的交换集线器(具有网桥功能的hub称之为交换集线器，仅具有中继功能的hub叫做集线器)，属于网桥的一种，连接电缆的每个接口都能提供类似网桥的功能；

#### 路由器/3层交换机

网络层面上连接两个网络，并对分组数据报文进行转发的设备，网桥是根据物理地址(MAC)进行处理，这个是通过IP地址进行处理，网络层的地址称之为IP地址；

路由器还具有分担网络负荷的作用，同事能具备一定的网络安全功能；

#### 4--7层交换机

负载均衡器是对多个服务器分散压力的4--7层交换机，分析收发数据，对其做特定处理，为了将同一个URL发送到多个后台多个服务器上，可以在服务器的前端增加一个负载均衡器。带宽控制也是这层交换机的重要功能之一；

#### 网关

处理传输层以上的数据，会使用一个表示层或者应用层网关，不能直接进行翻译的两个协议进行数据的转发和转换；

为什么手机和电脑的邮件能发送接收呢，在互联网与手机之间设立了一个网关，负责读取不同的协议之间的数据后对他们进行整合然后将相应的数据发送出去；

![](/image/gg.png)

同时，在使用www万维网时候，为了控制访问流量以及处于安全的考虑，经常使用代理服务器，代理服务器也是网关的一种称之为应用网关，有了应用网关，客户与服务器通信无需再网络层进行直接通信，而是从传输层到应用层对数据和访问进行各种控制和处理，防火墙就是一款通过网关通信，针对不同应用提高安全性的产品。

![](/image/hh.png)

#### 各种设备及其对应网络分层概览

![](/image/ii.png)

### 现代网络时态

#### 网络的构成

可以根据现实当中的高速公路比喻，计算机网络中有类似高速公路的部分，称之为骨干或核心，通常使用高速路由器相互连接使数据快速传输；

网络中相应于高速公路出口的地方称之为边缘网络(涉及接入层和汇聚层的网络)，常用的设备有多用路由器(多了按顺序种类发送数据的功能)和三层交换机；

连接边缘网络的叫做接入层和汇聚层，骨干网在于提高业务传输性能，网络的生存性，将具有业务智能化的路由器和交换机放到边缘网络，多为2层交换机和3层交换机；

#### 互联网通信

在家庭连接互联网的时候，会通过路由器连接到附近的交换机的通信会被再次连接到前边提到的接入层，甚至还可能通过边缘网络或主干网实现与目标地址之间的通信；

![](/image/jj.png)

#### 移动通信

手机一开机，就会连接附近的基站，基站也相当于网络的"接入层"。打电话的时候会直接发送到另外一端基站的手机号码，基站收集的通信请求被汇集到控制中心，之后连接到互联通信控制中心的主干网络，与互联网通信非常相似；

![](/image/kk.png)

#### 从信息发布者的角度看网络

托管主机(用于发布信息的主机放到互联网数据中心的机房，或者从该机房租赁一台计算机作为发送数据的主机)，这种方式的优点是不需要做服务器和网络运维的管理，只需要关注自己发布信息的特定网站即可；

对于网站中个别内容并发访问量高的，为了减少延迟，会集合多个存储于一起，通过连接高速网络，提高响应速度，这种方式称作数据中心；

数据中心由大型服务器，存储及计算机网络组成，甚至能连接到主干网络，最次也连接到边缘网络，数据中心网络中分布着3层交换机和高速路由器；

#### 虚拟化和云

以内容访问网站，抽奖网站为例子，可能在特定的日子访问量特别多，其余时间基本没人访问，但是也要保证网站可以正常运行，尤其像数据中心一样为多个服务器提供对外服务的情况下，如果提供固定的网络资源显然是低效的，虚拟化的出现即是当一个网站需要调整资源的时候，不动服务器和存储的数量，而是通过软件的方式将物理设备虚拟化，实现按需分配，按比例分配，对外提供可靠的服务；

根据虚拟化技术，通过使用资源的情况动态的对资源进行调整的机制称之为"云"，将虚拟化的系统根据需要自动的进行动态管理的部分称之为"智能协调云"，可以对服务器，存储以及整个网络进行整体管理，有了云，就可以使网络的使用这实现不论何种情况都能只获取或只提供需要信息的机制；

![](/image/ll.png)



##### <a href="http://book.douban.com/subject/24737674/">参考《图解TCP/IP》</a>



