---
layout: post
title: 网卡上的MAC与PHY，ARP
category: 技术
tags: Tig
keywords:
description:
---

笔记选自：[点击](http://www.kuqin.com/shuoit/20141110/343114.html)

    以太网的网卡包括OSI的模型两个层，数据链路层(芯片称之为MAC)与物理层(芯片称之为PHY),一般将两块芯片集成到一个芯片当中；

#### MAC：

    数据链路层的芯片称之为MAC控制器，这层包括MAC(介质访问控制)层与LLC(逻辑链路控制)层两个子层，除了要实现MAC与LLC之外，链路层芯片还需要提供PCI界面以实现与主机的数据交换；

    MAC从PCI数据总线得到IP数据包，将之拆分然后重新打包成64到1518的帧，这个帧里边包含SMAC，DMAC和数据的协议类型，最后还有一个DWORD的CRC码；其中DMAC的获取是通过ARP机制；

    IP地址与MAC地址的映射关系是ARP表，由操作系统与驱动程序完成，收到数据帧的时候，做完CRC校验，如果没有错误则去掉帧头，然后将数据包通过标准的接口传递给驱动和上层协议客栈，最终到达应用程序；

#### PHY:

    MAC芯片一端接PCI总线，另外一端连接的是PHY，以太网的物理层也包含多个子层，PHY将所有子层功能集成到一个芯片上；

#### 网络传输流程

    PHY在发送数据的时候，收到MAC发来的数据(PHY中没有帧，数据，CRC和地址的概念，只有数据)，转化并行数据位串行数据，按照物理层的编码规则(曼彻斯特编码等)进行数据编码，变成模拟信号发出数据，收数据时候流程反之；

	PHY还有个重要功能就是CSMA/CD的部分功能，可以检测网络是否为空闲状态，如果空闲了就隔开一个随机时间进行发送数据，不空闲就继续等待，如果两个网卡同时抢占一个通信信道，就会发生冲突，这个时候就需要冲突检测机构检测，然后等待一个随机的时间重新发送数据；

#### 关于冲突

    hub与交换机的区别，见上一遍笔记文章！

#### 传输介质

    隔离变压器将信号耦合到网线上，并没有起到放大信号的作用，那么网卡的传送能力和距离由什么确定呢，答案是PHY, 功率不能太大，太大就产生了EMI的问题，Marvell的phy可以传送180到200米，RJ-45网线实现与网卡的连接。


#### 其他

    一片网卡主要功能的实现就基本上是上面这些器件了。

    其他的，还有一颗EEPROM芯片，通常是一颗93C46。里面记录了网卡芯片的供应商ID、子系统供应商ID、网卡的MAC地址、网卡的一些配置，如SMI总线上PHY的地址，BOOTROM的容量，是否启用BOOTROM引导系统等东西。

    一块以太网卡就是这些部分组成。它们紧密地配合并且相互协调，供给我们一个稳定而告诉的网络接入。网络的普及不但极大地增加了工作效率，而且使我们可以自由的驰骋在Internet的海洋中！
